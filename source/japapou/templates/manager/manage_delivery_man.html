{% extends 'base.html' %}
{% load static %}

{% block title %}Entregadores - Gerenciamento{% endblock %}
{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/manager/manage_delivery_man.css' %}">
{% endblock %}

{% block content %}
<h1 class="page-title">Gerenciar Entregadores</h1>

<div class="entregadores-grid">
    {% for delivery_man in delivery_men %}
    <a href="{% url 'manager_delivery_man_detail' delivery_man.id %}" class="card">
        <div class="photo">
            {% if delivery_man.foto %}
                <img src="{{ delivery_man.foto.url }}" alt="{{ delivery_man.first_name }}">
            {% else %}
                <img src="{% static 'imgs/delivery_man/default.jpg' %}" alt="Sem foto">
            {% endif %}
        <div class="card-content">
            <h2>{{ delivery_man.first_name }} {{ delivery_man.last_name }}</h2>
            <p class="username">@{{ delivery_man.username }}</p>
            <p class="email"><i class="fas fa-envelope"></i> {{ delivery_man.email }}</p>
            <p class="phone"><i class="fas fa-phone"></i> {{ delivery_man.telefone }}</p>
        </div>
        <div class="actions">
            <a href="{% url 'manager_delivery_man_update' delivery_man.id %}" class="btn edit"><i class="fas fa-edit"></i></a>
            <button type="button"
                    class="btn delete"
                    data-id="{{ delivery_man.id }}"
                    data-name="{{ delivery_man.first_name }} {{ delivery_man.last_name }}">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </a>
    {% endfor %}

    <a href="{% url 'manager_delivery_man_create' %}" class="card add-card">
        <i class="fas fa-plus fa-3x"></i>
        <p>Adicionar Entregador</p>
    </a>
</div>

<!-- Modal de confirmação -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <h3>Confirmar Exclusão</h3>
        <p id="deleteMessage"></p>
        <div class="modal-actions">
            <form id="deleteForm" method="POST">
                {% csrf_token %}
                <button type="button" class="btn cancel" onclick="closeModal()">Cancelar</button>
                <button type="submit" class="btn confirm">Excluir</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function confirmDelete(id, name) {
    const modal = document.getElementById('deleteModal');
    const message = document.getElementById('deleteMessage');
    const form = document.getElementById('deleteForm');

    // monta a URL da view delete usando o id recebido
    form.action = `/manager/delivery-man/${id}/delete/`;
    message.textContent = `Deseja realmente excluir "${name}"?`;

    modal.classList.add('show');
}

function closeModal() {
    document.getElementById('deleteModal').classList.remove('show');
}

document.querySelectorAll('.btn.delete').forEach(btn => {
    btn.addEventListener('click', () => confirmDelete(btn.dataset.id, btn.dataset.name));
});
</script>
{% endblock %}

