{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/client/cart.css' %}">

<script>
    // Funções JavaScript para atualizar a quantidade e submeter o formulário
    function updateQuantity(itemId, change) {
        const input = document.getElementById('quantity-' + itemId);
        let current = parseInt(input.value);
        let newValue = current + change;

        if (newValue >= 1) {
            input.value = newValue;
            
            // Submete o formulário quando a quantidade muda
            const form = input.closest('form');
            if (form) {
                form.submit();
            }
        }
    }
</script>
{% endblock %}

{% block content %}
<div class="container-carrinho">
    <div class="carrinho-header">
        <h1 class="carrinho-titulo">Meu Carrinho</h1>

        <p>Compre mais R$ <b class="laranja">[valor]</b> para adquirir frete grátis </p>
        <p>gráfico que a parte concluída é var(--laranja-mais-claro) e o back é var(--azul-mais-claro)</p>

        <div class="icones-container">
            <button class="btn-icone" aria-label="Pesquisar">
                <i class="fas fa-search"></i>
            </button>
            
            <a href="{% url 'client_menu' %}">
                <button class="btn-icone" aria-label="Adicionar Novo Item">
                    <i class="fas fa-plus-circle"></i>
                </button>
            </a>
        </div>

        <div class="coluna-cabecalho">
            <span class="cab-produto">Produto</span>
            <span class="cab-preco-unitario">Preço Unit.</span>
            <span class="cab-quantidade">Quantidade</span>
            <span class="cab-subtotal">Subtotal</span>
        </div>
    </div>

    {% if not items %}
        <div class="carrinho-vazio">
            <p>Seu carrinho está vazio.</p>
            <a href="{% url 'client_menu' %}" class="btn-ver-pratos">Ver pratos</a>
        </div>
    {% else %}
        
        <div class="lista-itens">
            {% for item in items %}
            <div class="item-carrinho"> 
                
                <div class="item-detalhes">
                    <img 
                        src="https://placehold.co/100x100/1e293b/a5b4fc?text=Sushi" 
                        alt="{{ item.plate.name }}" 
                        class="item-imagem"
                    />
                    <div>
                        <p class="item-nome">{{ item.plate.name }}</p>
                        <p class="item-especificacoes">Especificações: Sem adição de pimenta.</p> 
                        
                        <form action="{% url 'remove_from_cart' %}" method="POST" class="form-remover">
                            {% csrf_token %}
                            <input type="hidden" name="item_id" value="{{ item.id }}">
                            <button type="submit" class="btn-remover">
                                Remover
                            </button>
                        </form>
                    </div>
                </div>

                <div class="item-preco-unitario">
                    R$ {{ item.plate.price|floatformat:2 }}
                </div>

                <div class="item-quantidade">
                    <form action="{% url 'update_cart_item' %}" method="POST" class="quantidade-control">
                        {% csrf_token %}
                        <input type="hidden" name="item_id" value="{{ item.id }}">
                        
                        <button type="button" onclick="updateQuantity('{{ item.id }}', -1)" class="btn-quant btn-quant-decremento">
                            –
                        </button>

                        <input 
                            type="number" 
                            name="quantity" 
                            id="quantity-{{ item.id }}" 
                            value="{{ item.quantity }}" 
                            min="1" 
                            max="99" 
                            class="input-quantidade"
                            onchange="this.form.submit()"
                        >

                        <button type="button" onclick="updateQuantity('{{ item.id }}', 1)" class="btn-quant btn-quant-incremento">
                            +
                        </button>
                    </form>
                </div>

                <div class="item-subtotal">
                    R$ {{ item.get_item_total|floatformat:2 }}
                </div>
            </div>
            {% endfor %}
        </div>

        <hr class="separador">

        <div class="checkout-box">
            <!-- <div class="frete-dropdown-container">
                <div class="frete-dropdown-wrapper">
                    <select class="frete-dropdown">
                        <option>Estimar Frete</option>
                        <option>Retirada no Local (R$ 0,00)</option>
                        <option>Entrega Padrão (R$ 10,00)</option>
                    </select>
                    <div class="frete-dropdown-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
            </div> -->
            <div class="frete-dropdown-container">
                <div class="frete-dropdown-wrapper"> <select class="frete-dropdown">
                        <option>Estimar Frete</option>
                        <option>Retirada no Local (R$ 0,00)</option>
                        <option>Entrega Padrão (R$ 10,00)</option>
                        </select>
                    <!-- <div class="frete-dropdown-icon"> <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg> -->
                    </div>
                </div>
            </div>

            <div class="total-final-container">
                <div class="total-final-row">
                    <h3 class="total-titulo">TOTAL</h3>
                    <div class="total-valor">
                        R$ {{ total|floatformat:2 }}
                    </div>
                </div>
                <p class="total-descricao">Taxa de frete incluída. Com tudo finalizado, vá ao Check Out</p>
            </div>

            <div class="checkout-btn-container">
                <form action="{% url 'create_order' %}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="btn-checkout">
                        Check Out
                    </button>
                </form>
            </div>
        </div>

    {% endif %}
</div>

<section>
    <a href="" class="container-btn-sessao teste2"><p class="btn-sessao teste2">Contate-nos</p></a>
    <div class="grid-container">
        <div class="grid-item area-a">
            <img src="{% static 'imgs/Grid(area-a).png' %}">
            <div class="overlay">Sushi Especial</div>
        </div>

        <div class="grid-item area-b">
            <img src="{% static 'imgs/Grid(area-b).png' %}">
            <div class="overlay">Sashimi Fresco</div>
        </div>

        <div class="grid-item area-c">
            <img src="{% static 'imgs/Grid(area-c).png' %}">
            <div class="overlay">Combinado Premium</div>
        </div>

        <div class="grid-item area-d">
            <img src="{% static 'imgs/Grid(area-d).png' %}">
            <div class="overlay">Onigiri</div>
        </div>

        <div class="grid-item area-e">
            <img src="{% static 'imgs/Grid(area-e).png' %}">
            <div class="overlay">Hot Roll Gourmet</div>
        </div>

    </div>
</section>

{% endblock %}